<script>
'use strict';
var PageBehaviors = PageBehaviors || {}; // namespace

/*
 * This behaviour is for smoothing multi-platform nuances and UX niggles.
 */

PageBehaviors.MultiPlatform = {

	_isWKWebViewEnabled : true, // Set to true if Cordova WKWebView is enabled

	// triggers input.focus() with a timeout
	autoFocus : function(input) {
		this._focus(input, 0);
	},

	// triggers input.focus() on everything except on iOS UIWebView. Sometimes if an input has already received autofocus it can result in disabling soft-keyboard text entry.
	shouldFocus : function(input) {
		if ( !this._isiOSUIWebView() ) {
			this._focus(input, 0);
		} else {
			console.log("iOS UIWebView shouldFocus disabled");
		}
	},

	_focus : function(input, delay) {
		setTimeout(function() {
			console.log("focus");
			input.focus();
		}, delay);
	},

	// hack for iOS to prevent scrolling view up when soft keyboard pops up in UIWebView
	shouldFocusWithoutScrollUp : function(e) {
		if ( this._isiOSUIWebView() ) {
			console.log("iOS UIWebView shouldFocusWithoutScrollUp");
			e.target.style.webkitTransform = 'translate3d(0px,-10000px,0)';
			webkitRequestAnimationFrame(function() { this.style.webkitTransform = ''; }.bind(e.target));
		}
	},

	_isiOS : function() {
		return navigator.userAgent.match(/iPhone|iPad|iPod/i);
	},

	// Only iOS 9+ supports WKWebView, older versions of iOS will fallback to UIWebView
	_isiOSUIWebView : function() {
		return (this._isiOS() && !(this._isWKWebViewEnabled && this._iOSVersion()>=9) );
	},

	_iOSVersion : function() {
		var minVersion = 7; // default to minimum iOS version supported by Cordova
		var results = navigator.userAgent.match(/(iphone|ipod|ipad).*os ([0-9_]+)/i);
		if (results && results.length === 3) {
			var versionStr = results[2];
			var version = parseInt( versionStr.substr(0, versionStr.indexOf('_')) );
			if ( version > minVersion ){
				//console.log("iOS version:" + version);
				return version;
			}
		}
		return minVersion;
	}

};
</script>

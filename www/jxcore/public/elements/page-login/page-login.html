<link rel="import" href="/bower_components/polymer/polymer.html">

<dom-module id="page-login">

<template>
    <form is="iron-form" id="form-login" method="post" action="/api/login" class="inset" >
        <paper-input name="username" label="Username" bind-value="{{username::input}}" error-   message="{{error_username}}" required></paper-input>
        <div class="alignCenter">
            <paper-button class="accent" raised on-click="submitForm">Save</paper-button>
        </div>
    </form>
</template>

<script>
Polymer({
    is: "page-login",
    properties: {
        username: {
            type: String,
            value: ""
        },
        error_username: {
            type: String,
            value: "Please enter a username."
        }
    },
    listeners: {
        'iron-form-invalid': '_formInvalid',
        'iron-form-submit': '_formSubmit',
        'iron-form-response': '_formResponse',
        'iron-form-error': '_formError'
    },
    created: function() {
        console.log(this.localName + ' was created');
    },
    ready: function() {
        console.log(this.localName + ' ready');
    },
    attached: function() {
        console.log(this.localName + ' was attached');
    },
    detached: function() {
        console.log(this.localName + ' was detached');
    },
    viewWillAppear: function() {
        console.log(this.localName + " viewWillAppear");
    },
    viewWillDisappear: function() {
        console.log(this.localName + " viewWillDisappear");
    },
    submitForm: function(event) {
        console.log('submit form');
        this._saveUsername();
        document.getElementById('form-login').submit();
    },
    _saveUsername: function() {
        if (this.username.length >0 ){
            myApp.username = this.username;
            console.log("name:" + this.username);
            return true;
        } else {
            console.log("Error with name input");
            return false;
        }
    },
    _formInvalid: function(e) {
        // notify user what went wrong on client
        console.log('Form invalid');
    },
    _formSubmit: function(e) {
        console.log("Form was submitted");
    },
    _formResponse: function(e) {
        console.log("Server Response: ",e.detail);
        // check server response and proceed if name is saved
        this._saveUsername();
        getURL("home");
    },
    _formError: function(e) {
        // handle what went wrong on server
        console.log("Form Error:", e.detail);
    }
});
</script>
</dom-module>